var e=Object.defineProperty,n=(n,a,t)=>(((n,a,t)=>{a in n?e(n,a,{enumerable:!0,configurable:!0,writable:!0,value:t}):n[a]=t})(n,"symbol"!=typeof a?a+"":a,t),t);import{d as a,_ as t,$ as l,a0 as r,a1 as u,a2 as s,y as i,k as o,l as c,E as d,C as m,a3 as p,F as f,G as h,t as x,x as b,X as v,a4 as g,a as y,w as _,r as N,j as T,H as C,a5 as O,a6 as U,q as I,S as A,a7 as P}from"./vendor.e09d404b.js";import{s as S,F as w}from"./FileSaver.min.ea758514.js";import{u as R}from"./usePropVModel.b50a1c52.js";import{_ as k,e as G,S as V}from"./index.e7370584.js";import{u as E}from"./uniqBy.7e8cf7db.js";import"./_baseIteratee.4ebf0afb.js";const D=a({name:"RaceActionInput",props:{modelValue:{type:String,required:!0}},setup:(e,n)=>{const a=R(n,e,"modelValue");return{actionProxy:a,labelClass:e=>({"form-button inline-flex flex-center p-px h-8 flex-auto":!0,"bg-blue-400 text-white hover:bg-blue-300":a.value===e}),svgClass:"fill-current h-6 py-px"}},data:()=>({mdiCancel:t,mdiShieldCheck:l,mdiThumbUp:r,mdiThumbDown:u,mdiThumbsUpDown:s})}),L=["d"],$=["d"],q=["d"],B=["d"],W=["d"];var F=k(D,[["render",function(e,n,a,t,l,r){return i(),o(f,null,[c("label",{class:d(e.labelClass("ban"))},[(i(),o("svg",{class:d(e.svgClass),viewBox:"0 0 24 24"},[c("path",{d:e.mdiCancel},null,8,L)],2)),m(c("input",{"onUpdate:modelValue":n[0]||(n[0]=n=>e.actionProxy=n),type:"radio",class:"hidden",value:"ban"},null,512),[[p,e.actionProxy]])],2),c("label",{class:d(e.labelClass("less"))},[(i(),o("svg",{class:d(e.svgClass),viewBox:"0 0 24 24"},[c("path",{d:e.mdiThumbDown},null,8,$)],2)),m(c("input",{"onUpdate:modelValue":n[1]||(n[1]=n=>e.actionProxy=n),type:"radio",class:"hidden",value:"less"},null,512),[[p,e.actionProxy]])],2),c("label",{class:d(e.labelClass("none"))},[(i(),o("svg",{class:d(e.svgClass),viewBox:"0 0 24 24"},[c("path",{d:e.mdiThumbsUpDown},null,8,q)],2)),m(c("input",{"onUpdate:modelValue":n[2]||(n[2]=n=>e.actionProxy=n),type:"radio",class:"hidden",value:"none"},null,512),[[p,e.actionProxy]])],2),c("label",{class:d(e.labelClass("more"))},[(i(),o("svg",{class:d(e.svgClass),viewBox:"0 0 24 24"},[c("path",{d:e.mdiThumbUp},null,8,B)],2)),m(c("input",{"onUpdate:modelValue":n[3]||(n[3]=n=>e.actionProxy=n),type:"radio",class:"hidden",value:"more"},null,512),[[p,e.actionProxy]])],2),c("label",{class:d(e.labelClass("pick"))},[(i(),o("svg",{class:d(e.svgClass),viewBox:"0 0 24 24"},[c("path",{d:e.mdiShieldCheck},null,8,W)],2)),m(c("input",{"onUpdate:modelValue":n[4]||(n[4]=n=>e.actionProxy=n),type:"radio",class:"hidden",value:"pick"},null,512),[[p,e.actionProxy]])],2)],64)}]]);function j(e){const n=Math.floor(e/24)+1,a=(()=>{switch(n){case 1:return"ジュニア級";case 2:return"クラシック級";case 3:return"シニア級";default:return`Year ${n}`}})(),t=e%2+1,l=(e-(t-1))/2%12+1;return{year:n,yearText:a,month:l,monthText:`${l} 月`,half:t,halfText:1===t?"前半":"後半"}}var M,J,K=k(a({name:"SingleModeTurnWidget",props:{value:{type:Number,required:!0}},setup:e=>({turn:h((()=>j(e.value)))})}),[["render",function(e,n,a,t,l,r){return x(e.turn.yearText)+" "+x(e.turn.monthText)+" "+x(e.turn.halfText)}]]);(J=M||(M={}))[J.DEBUT=900]="DEBUT",J[J.NOT_WINNING=800]="NOT_WINNING",J[J.PRE_OP=700]="PRE_OP",J[J.OP=400]="OP",J[J.G3=300]="G3",J[J.G2=200]="G2",J[J.G1=100]="G1";var H,X,Y=M;(X=H||(H={}))[X.TURF=1]="TURF",X[X.DART=2]="DART";var z,Q,Z=H;(Q=z||(z={}))[Q.JUNIOR=1]="JUNIOR",Q[Q.CLASSIC=2]="CLASSIC",Q[Q.SENIOR_OR_CLASSIC=3]="SENIOR_OR_CLASSIC",Q[Q.SENIOR=4]="SENIOR",Q[Q.URA=5]="URA";var ee=z;class ne{constructor(e){n(this,"characters"),n(this,"distance"),n(this,"entryCount"),n(this,"fanCounts"),n(this,"grade"),n(this,"ground"),n(this,"half"),n(this,"minFanCount"),n(this,"month"),n(this,"name"),n(this,"permission"),n(this,"stadium"),n(this,"targetStatus"),n(this,"track"),n(this,"turn"),this.characters=e.characters,this.distance=e.distance,this.entryCount=e.entryCount,this.fanCounts=e.fanCounts,this.grade=e.grade,this.ground=e.ground,this.half=e.half,this.minFanCount=e.minFanCount,this.month=e.month,this.name=e.name,this.permission=e.permission,this.stadium=e.stadium,this.targetStatus=e.targetStatus,this.track=e.track,this.turn=e.turn}years(){switch(this.permission){case ee.JUNIOR:return[1];case ee.CLASSIC:return[2];case ee.SENIOR_OR_CLASSIC:return[2,3];case ee.SENIOR:return[3];case ee.URA:return[4];default:throw Error(`Race.years: unknown permission: ${this.permission}`)}}turnCounts(){return this.years().map((e=>24*(e-1)+2*(this.month-1)+this.half-1))}groundText(){return Z[this.ground]}isTargetRace(){return this.grade>=Y.DEBUT||(this.permission>=ee.URA||void 0)}}var ae=k(a({name:"SingleModeTurnWidget",props:{value:{type:Number,required:!0}},setup:e=>({turn:h((()=>j(e.value)))})}),[["render",function(e,n,a,t,l,r){return i(),o("div",null,[c("div",null,x(e.turn.yearText),1),c("div",null,x(e.turn.monthText),1),c("div",null,x(e.turn.halfText),1)])}]]);const te={class:"flex max-w-2xl m-1"},le={class:"w-full rounded border-2 p-1 border-gray-200 flex flex-col justify-between max-w-lg"},re={class:"font-bold text-lg select-all"},ue={class:"float-right text-sm sm:hidden text-gray-500"},se=c("hr",{class:"border-t border-gray-300"},null,-1),ie={class:"text-xs sm:text-sm text-gray-600 space-x-2"},oe={class:"flex w-full"},ce=a({props:{turn:{type:Number,required:!0},race:{type:ne,required:!0},action:{type:String,required:!0},hideDate:{type:Boolean}},emits:["update:action"],setup(e,{emit:n}){const a=R({emit:n},e,"action"),t=e=>{if(e.grade===Y.NOT_WINNING)return"...";switch(e.ground){case Z.TURF:return"芝";case Z.DART:return"ダート";default:return Z[e.ground]}},l=e=>e.grade===Y.NOT_WINNING?"...":`${e.distance}m`,r=e=>{switch(e.grade){case Y.NOT_WINNING:return"未勝利戦";case Y.PRE_OP:return"Pre-OP";default:return Y[e.grade]}};return(n,u)=>{return i(),o("li",te,[c("div",{class:d(["text-sm text-center w-24 flex-none hidden sm:flex my-2 flex-center",{invisible:e.hideDate}])},[b(ae,{value:e.turn},null,8,["value"])],2),c("div",le,[c("div",null,[c("span",re,x(e.race.name),1),c("span",ue,[b(K,{value:e.turn},null,8,["value"])])]),se,c("div",ie,[c("span",null,x((s=e.race,s.grade===Y.NOT_WINNING?"...":s.stadium)),1),c("span",null,x(r(e.race)),1),c("span",null,x(t(e.race)),1),c("span",null,x(l(e.race)),1),c("span",null," +"+x(e.race.fanCounts[0])+"人 ",1)]),c("div",oe,[b(F,{modelValue:v(a),"onUpdate:modelValue":u[0]||(u[0]=e=>g(a)?a.value=e:null)},null,8,["modelValue"])])])]);var s}}});function de(e){return null!=e}const me=y(0);G.workboxCacheUpdate.addEventListener((e=>{e.data.payload.updatedURL===V&&(me.value+=1)}));const pe=function(e,n,{keepLatest:a=!1}={}){const t=y(null==n?void 0:n.value);return _(e,(l=>{a||(t.value=y(null==n?void 0:n.value).value),l.then((n=>{e.value===l&&(t.value=y(n).value)}))}),{immediate:!0}),t}(h((async()=>{me.value;const e=await fetch(V,{cache:"no-cache"});return(await e.text()).split("\n").map((e=>{try{return new ne(JSON.parse(e))}catch{return}})).filter(de)})),y([]),{keepLatest:!0});const fe={class:"flex flex-col overflow-hidden"},he={class:"flex-none flex flex-wrap items-center space-x-2"},xe={class:"inline-flex flex-col"},be=U(" ダート "),ve=U(" 芝 "),ge={class:"inline-flex flex-wrap w-48 space-x-2"},ye=U(" G1 "),_e=U(" G2 "),Ne=U(" G3 "),Te=U(" Pre-OP "),Ce=U(" OP "),Oe=U(" 未勝利戦 "),Ue=a({props:{modelValue:{type:Array,required:!0},defaultAction:{type:String,default:"none"}},emits:["update:modelValue"],setup(e,{emit:n}){const a=e,t=R({emit:n},a,"modelValue"),l=pe,r=N({query:"",modifiedOnly:!1,includeTurf:!0,includeDart:!0,includeG1:!0,includeG2:!0,includeG3:!0,includePreOP:!0,includeOP:!0,includeNotWinning:!0}),u=h((()=>l.value.flatMap((e=>e.turnCounts().map((n=>({turn:n,race:e}))))).sort(((e,n)=>e.turn<n.turn?-1:1)))),s=h((()=>u.value.filter((e=>{if(e.race.isTargetRace())return!1;if(r.query.trim()&&!r.query.split(" ").filter((e=>e.trim())).some((n=>e.race.name.includes(n)||e.race.stadium.includes(n))))return!1;if(r.modifiedOnly&&!t.value.some((n=>n.turn===e.turn&&n.name===e.race.name)))return!1;if(e.race.grade!==Y.NOT_WINNING){if(!r.includeTurf&&e.race.ground===Z.TURF)return!1;if(!r.includeDart&&e.race.ground===Z.DART)return!1}return!(!r.includeG1&&e.race.grade===Y.G1)&&(!(!r.includeG2&&e.race.grade===Y.G2)&&(!(!r.includeG3&&e.race.grade===Y.G3)&&(!(!r.includePreOP&&e.race.grade===Y.PRE_OP)&&(!(!r.includeOP&&e.race.grade===Y.OP)&&!(!r.includeNotWinning&&e.race.grade===Y.NOT_WINNING)))))})))),d=h((()=>E(s.value,(e=>`${e.turn}:${e.race.name}`)).map((e=>{var n,l;return{race:e.race,turn:e.turn,action:null!=(l=null==(n=t.value.find((n=>n.turn===e.turn&&n.name===e.race.name)))?void 0:n.action)?l:a.defaultAction,handleUpdateAction:n=>{t.value=[...t.value.filter((n=>!(n.turn===e.turn&&n.name===e.race.name))),...n===a.defaultAction?[]:[{turn:e.turn,name:e.race.name,action:n}]]}}}))));return(n,a)=>{const t=T("VirtualList");return i(),o("div",fe,[c("div",he,[m(c("input",{"onUpdate:modelValue":a[0]||(a[0]=e=>v(r).query=e),type:"search",class:"form-input",placeholder:"Search race or stadium name"},null,512),[[C,v(r).query]]),c("div",xe,[c("label",null,[be,m(c("input",{"onUpdate:modelValue":a[1]||(a[1]=e=>v(r).includeDart=e),class:"form-checkbox border",type:"checkbox"},null,512),[[O,v(r).includeDart]])]),c("label",null,[ve,m(c("input",{"onUpdate:modelValue":a[2]||(a[2]=e=>v(r).includeTurf=e),class:"form-checkbox border",type:"checkbox"},null,512),[[O,v(r).includeTurf]])])]),c("div",ge,[c("label",null,[ye,m(c("input",{"onUpdate:modelValue":a[3]||(a[3]=e=>v(r).includeG1=e),class:"form-checkbox border",type:"checkbox"},null,512),[[O,v(r).includeG1]])]),c("label",null,[_e,m(c("input",{"onUpdate:modelValue":a[4]||(a[4]=e=>v(r).includeG2=e),class:"form-checkbox border",type:"checkbox"},null,512),[[O,v(r).includeG2]])]),c("label",null,[Ne,m(c("input",{"onUpdate:modelValue":a[5]||(a[5]=e=>v(r).includeG3=e),class:"form-checkbox border",type:"checkbox"},null,512),[[O,v(r).includeG3]])]),c("label",null,[Te,m(c("input",{"onUpdate:modelValue":a[6]||(a[6]=e=>v(r).includePreOP=e),class:"form-checkbox border",type:"checkbox"},null,512),[[O,v(r).includePreOP]])]),c("label",null,[Ce,m(c("input",{"onUpdate:modelValue":a[7]||(a[7]=e=>v(r).includeOP=e),class:"form-checkbox border",type:"checkbox"},null,512),[[O,v(r).includeOP]])]),c("label",null,[Oe,m(c("input",{"onUpdate:modelValue":a[8]||(a[8]=e=>v(r).includeNotWinning=e),class:"form-checkbox border",type:"checkbox"},null,512),[[O,v(r).includeNotWinning]])])]),c("label",null,[U(" modified ("+x(e.modelValue.length)+") ",1),m(c("input",{"onUpdate:modelValue":a[9]||(a[9]=e=>v(r).modifiedOnly=e),class:"form-checkbox border",type:"checkbox"},null,512),[[O,v(r).modifiedOnly]])])]),b(t,{is:"ol",class:"flex-auto",values:v(d),"item-height":96},{default:I((({value:e,attrs:n,index:a})=>{var t;return[b(ce,A(n,{turn:e.turn,race:e.race,"hide-date":e.turn===(null==(t=v(d)[a-1])?void 0:t.turn),action:e.action,"onUpdate:action":e.handleUpdateAction}),null,16,["turn","race","hide-date","action","onUpdate:action"])]})),_:1},8,["values"])])}}});const Ie={class:"flex mt-1"},Ae={class:"flex-auto"},Pe={class:"max-w-xl"},Se={class:"flex items-center my-1"},we={class:"flex-auto flex items-center"},Re={type:"submit",class:"form-button flex-none w-32 h-10 inline-flex flex-center"},ke={class:"inline align-top fill-current h-8",viewBox:"0 0 24 24"},Ge=["d"],Ve=a({setup(e){const n=N({name:"custom_race",raceActions:[],defaultAction:"none"}),a=()=>{const e=(a=n,`# -*- coding=UTF-8 -*-\n# Code generated by auto-derby-plugin-generator 89d8649\n# URL: ${window.location.href}\n# Date: ${(new Date).toISOString()}\n\nimport auto_derby\nfrom auto_derby import single_mode\n\n\nfrom typing import Text, Dict, Tuple\n\n_ACTION_NONE = 0\n_ACTION_BAN = 1\n_ACTION_LESS = 2\n_ACTION_MORE = 3\n_ACTION_PICK = 4\n\n_DEFAULT_ACTION = _ACTION_${a.defaultAction.toUpperCase()}\n\n_RULES: Dict[Tuple[int, Text], int] = {\n${S(a.raceActions,(e=>e.turn),(e=>e.name)).map((e=>`    (${e.turn}, "${e.name}"): _ACTION_${e.action.toUpperCase()},`)).join("\n")}\n}\n\n\nclass Plugin(auto_derby.Plugin):\n    def install(self) -> None:\n        class Race(auto_derby.config.single_mode_race_class):\n            def score(self, ctx: single_mode.Context) -> float:\n                ret = super().score(ctx)\n                action = _RULES.get(\n                    (ctx.turn_count(), self.name),\n                    _DEFAULT_ACTION,\n                )\n                if action == _ACTION_BAN:\n                    ret = 0\n                elif action == _ACTION_LESS:\n                    ret -= 5\n                elif action == _ACTION_MORE:\n                    ret += 5\n                elif action == _ACTION_PICK:\n                    ret += 100\n                return ret\n\n        auto_derby.config.single_mode_race_class = Race\n\n\nauto_derby.plugin.register(__name__, Plugin())\n`);var a;w.exports.saveAs(new Blob([e],{type:"application/octet-stream"}),`${n.name}.py`)};return(e,t)=>{const l=T("i18n-t");return i(),o("form",{class:"flex-auto overflow-hidden flex flex-col max-w-xl",action:"javascript:void(0)",onSubmit:t[3]||(t[3]=e=>a())},[b(Ue,{modelValue:v(n).raceActions,"onUpdate:modelValue":t[0]||(t[0]=e=>v(n).raceActions=e),class:"flex-auto","default-action":v(n).defaultAction},null,8,["modelValue","default-action"]),c("div",Ie,[c("span",Ae,[b(l,{keypath:"race-plugin.default-strategy"})]),c("div",Pe,[b(F,{modelValue:v(n).defaultAction,"onUpdate:modelValue":t[1]||(t[1]=e=>v(n).defaultAction=e)},null,8,["modelValue"])])]),c("div",Se,[c("label",we,[b(l,{keypath:"plugin.name"}),m(c("input",{"onUpdate:modelValue":t[2]||(t[2]=e=>v(n).name=e),type:"text",class:"form-input flex-auto"},null,512),[[C,v(n).name]])]),c("button",Re,[(i(),o("svg",ke,[c("path",{d:v(P)},null,8,Ge)])),c("span",null,[b(l,{keypath:"plugin.generate"})])])])],32)}}});export{Ve as default};
